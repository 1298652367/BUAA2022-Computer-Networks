## 网络层

## 1.功能
- 只提供`简单灵活的`，`无连接的`，`尽最大努力交付`的数据报服务
- 可能`出错`，`丢失`，`重复`，`失序或超时`，可靠通信由更高层的 **`传输层`** 来完成
- 网络造价`大幅降低`，运行方式`灵活`，能够适用多种应用

### 1.异构网络互联
- 网络互联：两个以上的计算机网络，通过一定的方法，用一些中间设备（又称**中继设备**），互相连接起来，以构成更大的网络系统。
- 中继系统分类：
  - `物理层`：转发器，集线器。
  - `数据链路层`：网桥或交换机。
  - `网络层`：路由器
  - `网络层以上`：网关
> 网络互联通常指用`路由器`进行网络互联和路由选择。路由器是一台专用计算机，用于在互联网中进行路由选择。

-  **`TCP/IP`** 体系在网络层采用**标准化协议**，使`异构`的网络通过路由器可以使用`相同`的IP协议，使之互联后可被视为`一个虚拟IP网络`。
-  **`虚拟互联网络`** :也称为`逻辑互联网络`，指物理网络的**异构性**通过`IP协议`使之在网络层看起来像一个统一的网络，这种虚拟互联网络简称为`IP网络`。
- 优点：互联网上主机通信，就如同在一个网络上通信，看不到互联网各个网络具体异构细节。

### 2.路由与转发
- **`路由选择`** ：根据特定的路由选择协议构造`路由表`，同时按照复杂的`分布式算法`，经常/定期和相邻路由器交换路由信息而不断`更新维护路由表`，从而`动态`地改变所选择的路由。
- **`分组转发`** ：路由器根据`转发表查询`，将用户的IP数据报从合适的端口`转发`出去。

### 3.SDN基本概念

### 4.拥塞控制


## 2.路由算法

## 3.IPv4
### 1.IPv4分组
**`IPv4`** ：IP协议版本4，定义了`数据传送的基本单元`——`IP分组`及其确切的数据格式，以及一整套规则，指明分组如何处理、错误怎样控制等。

#### 1.IPv4分组格式

#### 2.IP数据报分片

### 2.IPv4地址与NAT

#### 1.IPv4地址
- 连接到Internet的每台主机/路由器都分配一个32bit的**全球唯一标识符**，即`IP地址`。
- 互联网早期采用的是分类的IP地址


-  **`IP地址::={<网络号>,<主机号>}`** ，网络号标志主机/路由器连接到的网络。主机号标志主机/路由器。
- 网络号在整个Internet范围内**唯一**，主机号在网络号指明的网络内**唯一**。
- 特殊的IP地址：
  -  **主机号全为0** ：本网络本身
  -  **主机号全为1** ：本网络广播地址，又称`直接广播地址`
  -  **127.x.x.x** ：保留为环回自检地址，表示任意主机本身，目的地址为环回地址的IP数据报永远不会出现在任何网络上
  -  **0.0.0.0** ：网络上的本主机
  -  **255.255.255.255** ：整个TCP/IP网络的广播地址，又称受限广播地址。实际使用中，由于路由器对广播域的隔离，其等效为本网络的广播地址。
- 三类IP地址使用范围
|类别|最大可用网络数目|第一个网络号|最后一个网络号|每个网络最大主机数|
|---|---|---|---|---|
| $A$ | $2^7-2$ | $1$ | $126$ | $2^24-2$ |
| $B$ | $2^14$ | $128.0$ | $191.255$ | $2^16-2$ |
| $A$ | $2^21$ | $192.0.0$ | $223.255.255$ | $2^8-2$ |

- A类少了网络号为**0和127**，主机数少了主机号**全为0和全为1**

- IP地址特点
  - IP包含网络号和主机号，因此IP地址是一种分等级的地址结构。其优点有
    - IP地址管理机构分配IP只分配网络号，主机号则由网络的单位自行分配，方便IP管理。
    - 路由器仅仅根据目的主机所连接的网络号来转发分组，减少路由表所占存储空间。
  - IP地址是标识一台主机/路由器和一条链路的接口。因此IP网络上的一个路由器必然至少拥有两个IP地址。
  - 用转发器/网桥等
