
## 数据链路层

## 1.功能
### 1.为网络层提供服务

- 无确认的无连接服务
- 有确认的无连接服务
- 有确认的面向连接服务
**有连接就一定要确认**

### 2.链路管理
数据链路层的连接的`建立`，`维持`和`释放`过程称为`链路管理`

链路两端结点通信前必须确认对方已处于`就绪状态`，这个过程称为`链路建立`

### 3.帧定界，帧同步与透明传输
- 帧长=数据长度+首部/尾部长度，作用是帧定界
- 帧同步：帧定界后，接收方要能够识别出帧的边界
- 透明传输：无论传输的数据是什么样的比特组合，都应当能在链路上传送。
### 4.流量控制
限制发送方的发送速率，使接收方能够及时处理接收到的数据，防止接收方的缓冲区溢出。
>OSI模型中数据链路层有流量控制功能，但是TCP/IP模型中流量控制功能被转移到了传输层。

### 5.差错控制

## 2.组帧
### 1.字符计数法
- 帧头部使用一个计数字段表明帧内字符数。
- 如果计数字段出错，即失去了帧边界划分的依据，收发双方将`失去同步`。

### 2.字符填充法
- 在帧头部和帧尾部填充一些特殊字符，作为帧的边界标志。
- 插入转义字符来转义非首尾的特殊字符。

### 3.零比特填充法
- 使用一个特定的比特模式，即`01111110`，作为帧的边界标志。
- 为了防止错误，在收到五个连续的1后自动插入一个0。

### 4.违规编码法
- 采用违规编码法
- 无需任何填充技术，便能实现数据传输的透明性，但只适用冗余编码的特殊编码环境。

## 3.差错控制
### 1.检错编码
#### 1.奇偶校验码
- 奇校验码：附加校验码后，数据位中1的个数为奇数
- 偶校验码：附加校验码后，数据位中1的个数为偶数

#### 2.循环冗余校验码(CRC)
- 生成多项式，阶数为r
- 数据的低位端加上r个0
- 数据与多项式相除(异或运算)，余数作为`帧检测序列(FCS)`替代末r位0
- `不可靠传输`：差错的帧直接丢弃

### 2.纠错编码
#### 海明码
`n`表示有效信息位数，`k`为校验位的位数，则信息位`n`和校验位`k`应该满足

$n+k+1\leq2^{k}$

校验位置于 $2^{k}$ 位上

校验位的值为所有使用该校验位的值的`异或`结果。

## 4.流量控制与可靠传输系统

### 1.流量控制、可靠传输与滑动窗口机制
#### 1.停止-等待流量控制基本原理
- 发送方发送一帧，等待接收方应答信号
- 接收方接收一帧，反馈一个应答信号
- 每次只能一帧，`传输效率低`

#### 2.滑动窗口流量控制基本原理
- 发送方维持一组连续的允许发送的帧的序号，称为`发送窗口`
- 接收方维持一组连续的允许接收的帧的序号，称为`接收窗口`
- 发送端每收到一个`确认帧`，发送窗口就向前滑动一个位置。若发送窗口内没有可发送的帧，则停止发送。
- 接收端收到数据帧后，将窗口向前移动一个位置，并发回确认帧。若收到的数据帧落在接收窗口之外，则一律丢弃。

**滑动窗口的特性：**
- 接收窗口向前滑动时，发送窗口才有可能向前滑动
- 滑动窗口的特殊形式
  - `停止-等待协议`：发送窗口大小=1，接收窗口大小=1
  - `后退N帧协议`：发送窗口大小>1，接收窗口大小=1
  - `选择重传协议`：发送窗口大小>1，接收窗口大小>1
- 接收窗口大小为1，可以保证帧`有序接收`
- 数据链路层的滑动窗口协议中，窗口大小在传输过程中`固定`

#### 3.可靠传输机制
- `确认`：无数据的控制帧，使得接收方可以让发送方知道哪些内容被正确接受。
  - 有些情况下为了提高效率，将确认捎带在一个回复帧中，称为`稍待确认`
- `超时重传`：发送方在发送某个数据帧后开始一个计时器，若一定时间内没收到发送的数据帧的确认帧，就重新发送该数据帧，直到发送成功为止
- `自动重传请求(ARQ)`：接收方请求发送方重传出错的数据帧来恢复出错的帧。

### 2.单帧滑动窗口与停止-等待协议
- 可能出现的问题
  - 数据帧丢失
  - 到达目的站的帧已遭破坏：超时重传
  - 数据帧正确但确认帧破坏
    - 出现相同发送序号的数据帧，表明发送端进行了超时重传
    - 连续出现相同序号的确认帧，表明接收端收到了重复帧

### 3.多帧滑动窗口与后退N帧协议(GBN)
- 接收方只允许按顺序接收帧
- 接收方对某一数据帧的确认表明该数据帧和`此前所有数据帧`均已正确无误地收到。
- 若采取n比特对帧编号，那么发送窗口地尺寸 $W_{T}$ 应满足 $1\leq W_{T}\leq2^{n}-1$

### 4.多帧滑动窗口与选择重传协议(SR)
- 为了提高信道利用率，可以设法只重传出现差错的数据帧或计时器超时的数据帧。这就需要`加大接收窗口`。
- 接收方怀疑出错便发送否定帧`NAK`，要求发送方对NAK中指定的帧重传。
- 接收窗口和发送窗口的大小是相同的，且最大值都是序号范围的一半。
- 若采取n比特对帧编号，那么发送窗口和接收窗口的尺寸满足 $W_{Tmax}=W_{Rmax}=2^{n-1}$
- 选择重传协议可以`避免重复传输`已经正确到达接收端的数据帧，但接收端要设置具有相当容量的`缓冲区`暂存那些未按序正确收到的帧。

